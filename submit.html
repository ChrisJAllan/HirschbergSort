<!DOCTYPE html>
<html>
<head>
<script src="https://www.gstatic.com/firebasejs/3.0.2/firebase.js"></script>
<script src="db.js"></script>
<script>
var database;
var results;

function getParam(name) {
	var regex = new RegExp("[?&]"+name+"(?:=([^&\n]*))?");
	var results = regex.exec(document.location.search);
	if (!results) return null;
	if (results[1] == "") return true;
	return decodeURIComponent(results[1].replace(/\+/g, " "));
}
/*
function submit() {
	return database.ref("Results/").push({
		UnixTime: Date.now(),
		Date: Date(),
		Position: getParam("position"),
		Manager: getParam("manager"),
		ReqNumber: getParam("number"),
		Results: results
	});
}*/
</script>
</head>
<body onload="load()">
<script>
function load() {
	//loadDB();
	
	var position = getParam("position");
	var manager = getParam("manager");
	var number = getParam("number");
	
	results = [];
	for (var i = 0; i < getParam("count"); i++) {
		results.push(getParam("res"+i));
	}
	
	if (results.length > 0) {
		//submit(position, manager, number, results);
	}

	if (getParam("print")) {
		open("print.html"+location.search);
	}
	if (getParam("mail")) {
		var subject = encodeURI("Competency Importance Results for the " + position + " Position");
		var endl = "\r\n";
		var body = "Hiring Manager: " + manager + endl;
		body += "Requisition #: " + number + endl + endl;
		body += "Competency importance ranking for "+position+"s:" + endl + endl;
		for (var i = 0; i < results.length; i++) {
			body += (i+1) +". "+results[i]+"\r\n";
		}
		body = encodeURIComponent(body);
		
		console.log("Launching mail");
		
		location.href = "mailto:someone@example.com?subject="+subject+"&body="+body;
	}
}
</script>
</body>
</html>

