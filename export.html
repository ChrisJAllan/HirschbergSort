<!DOCTYPE html>
<html>
<head>
	<title>Competency Ranking Report</title>
	<script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
	<script type="text/javascript" src="Downloadify/js/swfobject.js"></script>
	<script type="text/javascript" src="Downloadify/js/downloadify.min.js"></script>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body onload="load()">
<noscript><h1>This page requires javascript, which is disabled.</h1></noscript>
<div class="top"><img src="https://octa.net/Images/global/OCTA15_logo.png" class="logo" /><h1>Competency Ranking Report</h1><span style="min-width: 1in;"></span></div>
<!--
<div style="display:none;" id="login">
	<form action="#" target="none" onsubmit="login()">
		<p>Email: <input type="text" id="email" /></p>
		<p>Password: <input type="password" id="pass" /></p>
		<button type="submit">Log In</button>
	</form>
</div>
<div style="display:none;" id="loggedin">
	<a href="#" id="Export">Export</a>
</div>
-->
<div class="container" style="text-align:center;">
	<h3>Competency Ranking Report.csv</h3>
	<table>
	<tr>
	<td>Flash</td><td id="downloadify">You must have Flash 10 installed to download this file.</td>
	</tr>
	<tr>
	<td>HTML5 (New browsers only, Edge 13+):</td><td><a download="Competency Ranking Report.csv" id="htmldown">Download</a></td>
	</tr>
	</table>
</div>
<script>
function load() {
	// Initialize Firebase
	var config = {
		apiKey: "AIzaSyAR5mkKau0nYAF7BCrYdB1_EnqmFPlyPf4",
		authDomain: "hirschbergsort.firebaseapp.com",
		databaseURL: "https://hirschbergsort.firebaseio.com",
		storageBucket: "hirschbergsort.appspot.com",
	};
	firebase.initializeApp(config);
	
	getData();
}
/*
function login() {
	firebase.auth().signInWithEmailAndPassword( document.getElementById("email").value,
												document.getElementById("pass").value).catch(function(error) {
		// Handle Errors here.
		var errorCode = error.code;
		var errorMessage = error.message;
		alert(errorMessage);
	});
}*/

function getData() {
	var dataurl = "data:text/csv;charset=utf-8,";
	var newline = "\r\n"
	var data =	"Competency Ranking Report" + newline + newline +
				"Date,Position,Manager,Number,Results" + newline;	
	
	var ref=firebase.database().ref("Results/");
	ref.once("value").then(function(snapshot) {
		snapshot.forEach(function(child) {
			data += child.val().Date + ",";
			data += child.val().Position + ",";
			data += child.val().Manager + ",";
			data += child.val().ReqNumber + ",";
			child.val().Results.forEach(function(res) {
				data += res + ",";
			});
			data += newline;
		})
		
		dataurl += encodeURIComponent(data);
		document.getElementById("htmldown").href = dataurl;
		Downloadify.create("downloadify", {
			filename: "Competency Ranking Report.csv",
			data: data,
			swf: 'Downloadify/media/downloadify.swf',
			downloadImage: 'Downloadify/images/download.png',
			width: 100,
			height: 30,
			transparent: true,
			append: false
		});
	});
}
 
</script>
<!--<iframe style="display:none;" name="none"></iframe>-->
</body>
</html>

